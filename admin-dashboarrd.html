<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Admin - E2W</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body class="admin-body">
    <!-- Admin Sidebar -->
    <aside class="admin-sidebar">
        <div class="admin-logo">
            <i class="fas fa-shield-alt"></i>
            <span>E2W Admin</span>
        </div>

        <nav class="admin-nav">
            <a href="#dashboard" class="admin-nav-link active" onclick="showSection('dashboard')">
                <i class="fas fa-chart-line"></i>
                <span>Dashboard</span>
            </a>
            <a href="#sales" class="admin-nav-link" onclick="showSection('sales')">
                <i class="fas fa-dollar-sign"></i>
                <span>Vendas</span>
            </a>
            <a href="#products" class="admin-nav-link" onclick="showSection('products')">
                <i class="fas fa-box"></i>
                <span>Produtos</span>
            </a>
            <a href="#customers" class="admin-nav-link" onclick="showSection('customers')">
                <i class="fas fa-users"></i>
                <span>Clientes</span>
            </a>
            <a href="#orders" class="admin-nav-link" onclick="showSection('orders')">
                <i class="fas fa-shopping-cart"></i>
                <span>Pedidos</span>
            </a>
            <a href="#financial" class="admin-nav-link" onclick="showSection('financial')">
                <i class="fas fa-wallet"></i>
                <span>Financeiro</span>
            </a>
            <a href="#settings" class="admin-nav-link" onclick="showSection('settings')">
                <i class="fas fa-cog"></i>
                <span>Configurações</span>
            </a>
        </nav>

        <div class="admin-user" data-gender="male">
            <div class="admin-user-avatar" aria-hidden="true">A</div>
            <div class="admin-user-info">
                <strong>Administrador</strong>
                <span>Administrador</span>
            </div>
            <button onclick="logout()" title="Sair">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </aside>

    <!-- Admin Content -->
    <main class="admin-content">
        <header class="admin-header">
            <h1 id="sectionTitle">Dashboard</h1>
            <div class="admin-header-actions">
                <button class="admin-btn" onclick="location.href='index.html'" title="Ver Loja">
                    <i class="fas fa-store"></i>
                </button>
                <button class="admin-btn" onclick="showNotifications()" title="Notificações">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="pendingOrdersBadge">0</span>
                </button>
            </div>
        </header>

        <div class="admin-sections">
            <!-- Dashboard Section -->
            <section class="admin-section active" id="dashboard-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon bg-primary">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Vendas Hoje</span>
                            <span class="stat-value" id="todaySales">$0.00</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon bg-secondary">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Pedidos</span>
                            <span class="stat-value" id="totalOrders">0</span>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon bg-accent">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <span class="stat-label">Clientes</span>
                            <span class="stat-value" id="totalCustomers">0</span>
                        </div>
                    </div>
                </div>

                <!-- Gráfico de evolução financeira (também exibido no dashboard) -->
                <div class="dashboard-card">
                    <h3>Evolução Financeira</h3>
                    <div style="height:260px;">
                        <canvas id="financialChartDashboard"></canvas>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>Pedidos Recentes</h3>
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Cliente</th>
                                    <th>Valor</th>
                                    <th>Status</th>
                                    <th>Data</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="recentOrdersTable">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 2rem; color: var(--gray-500);">
                                        Nenhum pedido encontrado
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            

            <!-- Sales Section -->
            <section class="admin-section" id="sales-section">
                <div class="dashboard-card">
                    <h3>Vendas do Dia</h3>
                    <p style="margin-bottom:1rem; color:var(--gray-600);">
                        Aqui aparecem as vendas computadas quando você marca um pedido como <strong>Concluído (+)</strong>.
                    </p>
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Cliente</th>
                                    <th>Valor</th>
                                    <th>Comissão</th>
                                </tr>
                            </thead>
                            <tbody id="salesTable"></tbody>
                        </table>
                    </div>
                    <div style="margin-top:1rem; text-align:right; font-weight:600; display:flex; flex-direction:column; gap:0.25rem; align-items:flex-end;">
                        <span>Total do dia: <span id="salesTotal">R$ 0,00</span></span>
                        <span>Comissão do dia: <span id="salesCommissionTotal">R$ 0,00</span></span>
                    </div>
                </div>
            </section>

            <!-- Products Section -->
            <section class="admin-section" id="products-section">
                <div class="section-header-actions">
                    <button class="btn btn-primary" onclick="openAdminAddProductModal()">
                        <i class="fas fa-plus"></i> Adicionar Produto
                    </button>
                </div>

                <div class="dashboard-card">
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Imagem</th>
                                    <th>Nome</th>
                                    <th>Categoria</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="productsTable"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            

            <!-- Modal: Adicionar Produto (Admin) -->
            <div class="admin-modal" id="adminAddProductModal">
                <div class="admin-modal-backdrop" onclick="closeAdminAddProductModal()"></div>
                <div class="admin-modal-content">
                    <div class="admin-modal-header">
                        <h3><i class="fas fa-box-open"></i> Novo Produto na Loja</h3>
                        <button class="admin-modal-close" onclick="closeAdminAddProductModal()">&times;</button>
                    </div>
                    <div class="admin-modal-body">
                        <form id="adminAddProductForm" onsubmit="saveAdminNewProduct(event)">
                            <div class="admin-add-product-left">
                                <p class="admin-add-product-hint">
                                    Preencha os campos principais e clique em <strong>Salvar Produto</strong> para que ele apareça na loja.
                                </p>
                                <div class="form-group">
                                    <label>Nome do Produto <span>*</span></label>
                                    <input type="text" name="name" placeholder="Ex: Furadeira de Impacto 850W" required>
                                </div>
                                <div class="form-group">
                                    <label>Preço estimado (R$)</label>
                                    <input type="number" name="price" min="0" step="0.01" placeholder="Ex: 1999,90">
                                </div>
                                <div class="form-group">
                                    <label>Categoria que vai aparecer <span>*</span></label>
                                    <select name="category" required>
                                        <option value="industrial">Área principal da Home (Industrial)</option>
                                        <option value="anmax">Sessão Anmax</option>
                                        <option value="brasilcr">Sessão BrasilCR</option>
                                        <option value="up">Sessão UP Equipamentos</option>
                                        <option value="flach">Sessão Flach</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Rótulo de destaque (opcional)</label>
                                    <input type="text" name="badge" placeholder="Ex: Promoção, Novo, Lançamento, % OFF">
                                </div>
                            </div>

                            <div class="admin-add-product-right">
                                <div class="form-group">
                                    <label>URL da Imagem Principal <span>*</span></label>
                                    <input type="url" name="image" placeholder="Cole aqui o link completo da imagem (https://...)" required>
                                    <small>Use o endereço da imagem do site do fornecedor (Anmax, BrasilCR, UP, Flach).</small>
                                </div>
                                <div class="form-group">
                                    <label>Imagens Extras (opcional)</label>
                                    <input type="text" name="extraImages" placeholder="https://img1..., https://img2...">
                                    <small>Separe várias imagens com vírgula para montar a galeria.</small>
                                </div>
                                <div class="form-group">
                                    <label>Vídeo do Produto (YouTube / MP4) (opcional)</label>
                                    <input type="url" name="video" placeholder="https://youtu.be/... ou https://...mp4">
                                </div>
                                <div class="form-group">
                                    <label>Descrição completa <span>*</span></label>
                                    <textarea name="description" rows="4" placeholder="Resumo do produto, principais características, aplicação, garantia..." required></textarea>
                                </div>
                                <div class="admin-add-product-alert">
                                    <i class="fas fa-info-circle"></i>
                                    <span>Após salvar, o produto entra na lista de Produtos/ADM e pode aparecer na área da home conforme a categoria escolhida.</span>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="admin-modal-footer">
                        <button class="btn btn-secondary" onclick="closeAdminAddProductModal()">Cancelar</button>
                        <button class="btn btn-primary" form="adminAddProductForm" type="submit">Salvar Produto</button>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            <section class="admin-section" id="orders-section">
                <div class="dashboard-card">
                    <h3>Todos os Pedidos</h3>
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Cliente</th>
                                    <th>Telefone</th>
                                    <th>Endereço</th>
                                    <th>Valor</th>
                                    <th>Comissão</th>
                                    <th>Status</th>
                                    <th>Data</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTable"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Modal de Galeria de Imagens do Produto -->
            <div class="modal" id="productGalleryModal" style="display:none;">
                <div class="modal-content">
                    <button class="modal-close" onclick="closeProductGallery()">&times;</button>
                    <h3 id="galleryProductTitle">Imagens do Produto</h3>
                    <div id="galleryImages" class="product-gallery-grid"></div>
                </div>
            </div>

            <!-- Customers Section -->
            <section class="admin-section" id="customers-section">
                <div class="dashboard-card">
                    <h3>Crescimento da Carteira de Clientes</h3>
                    <div style="display:flex; justify-content:space-between; align-items:center; gap:1rem; margin-bottom:1rem; flex-wrap:wrap;">
                        <p style="margin:0; color:var(--gray-600);">
                            Veja quantos clientes novos fizeram cadastro ou pedido em cada período.
                        </p>
                        <div>
                            <button class="btn btn-sm btn-secondary" onclick="updateCustomerGrowthChart('day')">Dia</button>
                            <button class="btn btn-sm btn-secondary" onclick="updateCustomerGrowthChart('week')">Semana</button>
                            <button class="btn btn-sm btn-secondary" onclick="updateCustomerGrowthChart('month')">Mês</button>
                            <button class="btn btn-sm btn-secondary" onclick="updateCustomerGrowthChart('year')">Ano</button>
                        </div>
                    </div>
                    <div style="height:280px;">
                        <canvas id="customerGrowthChart"></canvas>
                    </div>
                </div>

                <div class="dashboard-card" style="margin-top:1.5rem;">
                    <h3>Clientes Cadastrados</h3>
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Email</th>
                                    <th>País</th>
                                    <th>CNPJ</th>
                                    <th>Data</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="customersTable"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Modal de Detalhes do Cliente -->
            <div class="admin-modal" id="customerDetailsModal">
                <div class="admin-modal-backdrop" onclick="closeCustomerDetails()"></div>
                <div class="admin-modal-content">
                    <div class="admin-modal-header">
                        <h3><i class="fas fa-user-circle"></i> Detalhes do Cliente</h3>
                        <button class="admin-modal-close" onclick="closeCustomerDetails()">&times;</button>
                    </div>
                    <div class="admin-modal-body">
                        <div id="customerDetailsInfo"></div>
                        <h4 style="margin-top:1rem; color:var(--primary);">Histórico de Pedidos</h4>
                        <div class="table-responsive">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Data</th>
                                        <th>ID do Pedido</th>
                                    </tr>
                                </thead>
                                <tbody id="customerOrdersTable"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="admin-modal-footer">
                        <button class="btn btn-secondary" onclick="closeCustomerDetails()">Fechar</button>
                    </div>
                </div>
            </div>

            <!-- Modal de Detalhes do Pedido (itens) -->
            <div class="admin-modal" id="orderItemsModal">
                <div class="admin-modal-backdrop" onclick="closeOrderItems()"></div>
                <div class="admin-modal-content">
                    <div class="admin-modal-header">
                        <h3><i class="fas fa-receipt"></i> Itens do Pedido</h3>
                        <button class="admin-modal-close" onclick="closeOrderItems()">&times;</button>
                    </div>
                    <div class="admin-modal-body">
                        <div id="orderItemsInfo" style="margin-bottom:1rem;"></div>
                        <div class="table-responsive">
                            <table class="admin-table">
                                <thead>
                                    <tr>
                                        <th>Produto</th>
                                        <th>Qtd</th>
                                        <th>Preço</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="orderItemsTable"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="admin-modal-footer">
                        <button class="btn btn-secondary" onclick="closeOrderItems()">Fechar</button>
                    </div>
                </div>
            </div>

            <!-- Financial Section -->
            <section class="admin-section" id="financial-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <h4>Receita Total</h4>
                        <p class="stat-value" id="totalRevenue">R$ 0,00</p>
                    </div>
                    <div class="stat-card">
                        <h4>Comissão</h4>
                        <p class="stat-value" id="pendingRevenue">R$ 0,00</p>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>Evolução Financeira</h3>
                    <div style="display:flex; justify-content:space-between; align-items:center; gap:1rem; margin-bottom:1rem; flex-wrap:wrap;">
                        <p style="margin:0; color:var(--gray-600);">
                            Compare receita (azul) e comissão (verde) ao longo do tempo.
                        </p>
                        <div>
                            <button class="btn btn-sm btn-secondary" onclick="updateFinancialChart('day')">Dia</button>
                            <button class="btn btn-sm btn-secondary" onclick="updateFinancialChart('month')">Mês</button>
                            <button class="btn btn-sm btn-secondary" onclick="updateFinancialChart('year')">Ano</button>
                        </div>
                    </div>
                    <div style="height:260px;">
                        <canvas id="financialChart"></canvas>
                    </div>
                </div>

                <div class="dashboard-card">
                    <h3>Histórico Financeiro (valores consolidados)</h3>
                    <p style="margin-bottom:1rem; color:var(--gray-600);">
                        Vendas consolidadas automaticamente 6 horas após entrarem na aba Vendas do Dia. Esses valores não podem ser alterados.
                    </p>
                    <div style="display:flex; justify-content:flex-end; gap:0.5rem; margin-bottom:0.75rem;">
                        <button class="btn btn-secondary btn-sm" onclick="copyFinancialSummaryPreviousMonth()">Copiar resumo mês anterior</button>
                        <button class="btn btn-primary btn-sm" onclick="copyFinancialSummaryCurrentMonth()">Copiar resumo mês atual</button>
                    </div>
                    <div class="table-responsive">
                        <table class="admin-table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Cliente</th>
                                    <th>Valor</th>
                                    <th>Comissão</th>
                                </tr>
                            </thead>
                            <tbody id="financialTable"></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section class="admin-section" id="settings-section">
                <div class="dashboard-card">
                    <h3>Configurações Administrativas</h3>
                    <p style="color:var(--gray-600);">Aqui você pode visualizar o e-mail administrativo e alterar a senha de acesso ao painel.</p>
                    <div style="display:flex; gap:1rem; flex-wrap:wrap; margin-top:1rem;">
                        <div style="flex:1 1 320px;">
                            <form id="settingsForm">
                                <div class="form-group">
                                    <label>E-mail administrativo</label>
                                    <input type="text" id="adminEmailDisplay" readonly value="henriquess1999@gmail.com" style="background:#0b0b0b; color:var(--gray-800); border:1px solid rgba(191,161,74,0.16); padding:0.6rem; border-radius:6px; width:100%;">
                                    <small style="color:var(--gray-600);">O e-mail é mostrado para referência. Para alterar o e-mail administrativo atualmente é necessário editar o arquivo de configuração do projeto.</small>
                                </div>
                                <div style="margin-top:0.5rem;">
                                    <button type="button" class="btn btn-secondary" onclick="logout()">Sair da sessão</button>
                                </div>
                            </form>
                        </div>

                        <div style="flex:1 1 320px;">
                            <form id="changePasswordForm">
                                <h4>Alterar senha</h4>
                                <div class="form-group">
                                    <label>Senha Atual</label>
                                    <input type="password" name="currentPassword" required style="width:100%; padding:0.5rem; background:#0b0b0b; border:1px solid rgba(191,161,74,0.16); border-radius:6px; color:var(--gray-800);">
                                </div>
                                <div class="form-group">
                                    <label>Nova Senha</label>
                                    <input type="password" name="newPassword" required style="width:100%; padding:0.5rem; background:#0b0b0b; border:1px solid rgba(191,161,74,0.16); border-radius:6px; color:var(--gray-800);">
                                </div>
                                <div class="form-group">
                                    <label>Confirmar Nova Senha</label>
                                    <input type="password" name="confirmPassword" required style="width:100%; padding:0.5rem; background:#0b0b0b; border:1px solid rgba(191,161,74,0.16); border-radius:6px; color:var(--gray-800);">
                                </div>
                                <div style="margin-top:0.75rem; text-align:right;">
                                    <button class="btn btn-primary" type="submit">Salvar nova senha</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <link rel="stylesheet" href="admin.css">
    <script src="js/products.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/admin-auth.js"></script>
    <script>
        // Proteção simples do dashboard
        if (!window.AdminAuth || !window.AdminAuth.isLogged()) {
            window.location.href = 'admin.login.html';
        }
    </script>
</body>

</html>